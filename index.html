<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Registration</title>
</head>
<body>
    <h2>Recording Attendance...</h2>
    <p id="status">Please wait, fetching your location...</p>

    <script>
        // Get URL parameters (Employee ID & Name)
        function getQueryParam(param) {
            let urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        let empId = getQueryParam("id");
        let empName = getQueryParam("name");

        // Check if geolocation is available
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(position => {
                let lat = position.coords.latitude;
                let lng = position.coords.longitude;

                let scriptURL = "https://script.google.com/macros/s/AKfycbyYdKaNVgTTVSX01O1dMygM9nWGay4-pDFJw3Xdz4Mvq_Au0Fj9ixzNbH0fk4y9iHFHxg/exec";
                let requestURL = `${scriptURL}?id=${empId}&name=${empName}&lat=${lat}&lng=${lng}`;

                // Send data to Google Sheets
                fetch(requestURL)
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById("status").innerHTML = "✅ Attendance Recorded Successfully!";
                    })
                    .catch(error => {
                        document.getElementById("status").innerHTML = "❌ Error: " + error;
                    });

            }, error => {
                document.getElementById("status").innerHTML = "❌ Location access denied. Please allow location permissions.";
            });
        } else {
            document.getElementById("status").innerHTML = "❌ Geolocation is not supported on your device.";
        }
    </script>
</body>
</html>
